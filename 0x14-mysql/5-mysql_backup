#!/bin/bash

# Check if the password argument is provided
if [ -z "$1" ]; then
    echo "ERROR: Usage: $0 <MySQL Password>"
    exit 1
fi

# MySQL root password passed as an argument
MYSQL_PASSWORD="$1"

# Get the current date in day-month-year format
DATE=$(date +%d-%m-%Y)

# Define the backup file name
BACKUP_FILE="backup.sql"

# Define the archive file name
ARCHIVE_FILE="${DATE}.tar.gz"

echo "--------------------------------------------------"
echo "Starting MySQL backup process..."
echo "--------------------------------------------------"

# Dump all MySQL databases
echo "Step 1: Generating MySQL dump..."
mysqldump -u root -p"$MYSQL_PASSWORD" --all-databases > "$BACKUP_FILE"

# Check if mysqldump was successful
if [ $? -eq 0 ]; then
    echo "MySQL dump successful!"
else
    echo "ERROR: MySQL dump failed. Exiting."
    exit 1
fi

# Compress the dump into a tar.gz archive
echo "Step 2: Compressing the backup..."
tar -czf "$ARCHIVE_FILE" "$BACKUP_FILE"

# Check if tar was successful
if [ $? -eq 0 ]; then
    echo "Backup successfully compressed into $ARCHIVE_FILE"
else
    echo "ERROR: Compression failed. Exiting."
    exit 1
fi

# Clean up the uncompressed backup file
# rm "$BACKUP_FILE"

echo "--------------------------------------------------"
echo "Backup process completed successfully!"
echo "Backup saved as: $ARCHIVE_FILE"
echo "--------------------------------------------------"

